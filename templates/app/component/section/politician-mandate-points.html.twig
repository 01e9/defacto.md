{# @var \App\Entity\Politician politician #}
{# @var \App\Entity\Mandate mandate Optional #}
{# @var int rank Optional #}
{# @var bool is_mandate_page Optional #}

{% import 'macros.html.twig' as macros %}

{% set is_mandate_page = is_mandate_page is defined ? is_mandate_page : false %}
{% set is_competence_use_trakced = mandate and mandate.election.competenceUseTracked %}
{% set maxPhotoWidth = '8rem' %}

<div class="container-fluid px-0 py-4 bg-dark-pattern text-white">
    <div class="container">
        <div class="row">
            <div class="col text-center">
                <h1 class="mb-0">
                    {% if is_mandate_page %}
                        <a
                            href="{{ path('politician', {'slug': politician.slug}) }}"
                            class="text-white"
                        >
                            {{- "" -}}
                            <span itemprop="givenName">{{ politician.firstName }}</span>
                            <span itemprop="familyName">{{ politician.lastName }}</span>
                            {{- "" -}}
                        </a>
                    {% else %}
                        <span itemprop="givenName">{{ politician.firstName }}</span>
                        <span itemprop="familyName">{{ politician.lastName }}</span>
                    {% endif %}
                </h1>
            </div>
        </div>
        <div class="row align-items-lg-center text-center">
            <div class="col-12 col-lg text-lg-right text-info">
                {% if rank %}
                    <sup class="font-size-2 mr-3 position-relative">
                        {{- "label.the_place"|trans|lower -}}
                        <a
                            href="{{ path('mandates', {"electionSlug": mandate.election.slug}) }}"
                            class="position-absolute btn btn-sm btn-outline-warning text-nowrap"
                            style="right: 0; top: 3.3rem;"
                        ><small><span class="fa fa-star mr-2"></span>{{ "action.see_the_top"|trans }}</small></a>
                        {{- "" -}}
                    </sup>
                    <span class="font-size-6 text-warning">{{ rank }}</span>
                {% endif %}
            </div>
            <div class="col-12 col-lg-auto px-lg-5 order-first order-lg-0">
                {% set image %}
                    <img
                        src="{{ macros.politician_photo_url(politician) }}"
                        alt="{{ politician.firstName ~ " " ~ politician.lastName }}"
                        class="d-inline-block bg-white rounded-circle politician-photo my-2"
                        style="max-width: {{ maxPhotoWidth }};"
                        itemprop="image"
                    >
                {% endset %}
                {% if is_mandate_page %}
                    <a
                        href="{{ path('politician', {'slug': politician.slug}) }}"
                        class="d-inline-block"
                    >{{ image }}</a>
                {% else %}
                    {{ image }}
                {% endif %}
            </div>
            <div class="col-12 col-lg text-lg-left text-info">
                {% if mandate and is_competence_use_trakced %}
                    <span class="font-size-6 text-warning">{{ mandate.competenceUsesPoints }}</span>
                    <sup class="font-size-2 ml-3 position-relative">
                        {{- "text.points"|trans({"%count%": mandate.competenceUsesPoints}) -}}
                        {%- if not is_mandate_page and mandate.competenceUsesPoints -%}
                            <a
                                href="{{ path('mandate', {'electionSlug': mandate.election.slug, 'politicianSlug': politician.slug}) }}"
                                class="position-absolute btn btn-sm btn-outline-warning text-nowrap"
                                style="left: 0; top: 3.3rem;"
                            ><small>{{ "action.see_details"|trans }}<span class="fa fa-chart-pie ml-2"></span></small></a>
                        {%- endif -%}
                    </sup>
                {% endif %}
            </div>
        </div>
        {% if mandate %}
            <div class="row">
                <div class="col text-center">
                    <div class="d-inline-block mt-5 mt-lg-2">
                        <div class="row">
                            <div class="text-left col-6 col-md-auto">
                                <span class="badge badge-primary text-light">{{ mandate.beginDate|date }}</span>
                            </div>
                            <div class="col-12 col-md order-first order-md-0">
                                <span class="badge badge-light">{{ mandate.institutionTitle.title.name }}</span>
                            </div>
                            <div class="text-right col-6 col-md-auto">
                                <span class="badge badge-primary text-light">{{ mandate.endDate|date }}</span>
                            </div>
                        </div>
                        {% if mandate.endDate > date() %}
                            <div class="progress thin bg-light mandate-period mt-3">
                                <div class="progress-bar bg-primary rounded"
                                     style="width: {{ '' ~ macros.get_date_interval_progress(mandate.beginDate, mandate.endDate) }}%;"
                                >
                                    <span class="fas fa-dot-circle bg-white text-primary rounded-circle"></span>
                                </div>
                            </div>
                            <div class="mt-3 small text-light text-right">
                                <small>{{ "text.the_mandate_ends_in"|trans({"%time%": mandate.endDate|ago}) }}</small>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

