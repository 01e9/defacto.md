{% extends 'app/base.html.twig' %}
{% import 'macros.html.twig' as macros %}

{% block html_class %}bg-dark-pattern{% endblock %}
{% block body_class %}bg-transparent{% endblock %}

{% block title %}Circumscripție{% endblock %}

{% set logoSize = '2rem' %}

{% block main %}
    <div class="container-fluid bg-light-pattern">
        {% include 'app/component/after-header-space.html.twig' %}
        <div class="container">
            <div class="row mb-3">
                <div class="col">
                    <h1 class="text-center">{{ constituency.name }}</h1>
                </div>
            </div>
        </div>
        {% for election in elections %}
            <div class="container">
                <div class="row mb-4">
                    <div class="col">
                        <h4 class="text-center text-secondary">{{ election.election.name }} {{ election.election.date|date }}</h4>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col col-lg-4">
                        <div class="card">
                            <div class="card-body p-0">
                                {% if constituency.hasMap() %}
                                <img
                                    src="https://maps.googleapis.com/maps/api/staticmap?size=300x300&scale=2&center={{ constituency.map.lat }},{{ constituency.map.lng }}&markers=color:%23af2227%7Clabel:{{ constituency.number }}%7C{{ constituency.map.lat }},{{ constituency.map.lng }}&zoom=10&language={{ app.request.locale }}&key={{ google_maps_api_key }}"
                                    alt="Map"
                                    class="img-fluid w-100"
                                >
                                {% endif %}
                            </div>
                            <div class="card-footer p-0">
                                <a
                                    href="{{ constituency.link }}"
                                    target="_blank"
                                    class="btn btn-link btn-sm btn-block mb-0"
                                >Detalii circumscripție</a>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <h3 class="text-center mb-3">{{ "title.candidates_with_most_chances"|trans }}<span class="text-muted">*</span></h3>
                        <div class="row mb-4 justify-content-around">
                            {% for candidate in election.candidates %}
                                <div class="col-4">
                                    <div class="card bg-light">
                                        <div class="card-header text-center">
                                            {{ candidate.politician.firstName }}
                                            {{ candidate.politician.lastName }}
                                        </div>
                                        <div class="card-body p-0">
                                            <img
                                                src="{{ macros.politician_photo_url(candidate.politician) }}"
                                                alt="Politician"
                                                class="img-fluid w-100"
                                            >
                                        </div>
                                        {% if (candidate.party) %}
                                            <div class="card-footer">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                                                        <div style="width: {{ logoSize }};">
                                                            <img
                                                                src="{{ macros.party_logo_url(candidate.party) }}"
                                                                alt="Partid"
                                                                class="img-rounded"
                                                                style="max-height: {{ logoSize }}; max-width: {{ logoSize }};"
                                                            >
                                                        </div>
                                                    </div>
                                                    <div class="col pl-0">
                                                        {{ candidate.party.name }}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="alert alert-light" role="alert">
                            <h6 class="alert-heading">{{ "title.candidates_metodology"|trans }}</h6>
                            <p class="mb-0 small">
                                Platforma deFacto.md monitorizează și prezintă programele electorale ale candidaților uninominali
                                cu cele mai mari șanse de a câștiga la alegerile din {{ election.election.date|date }}.
                                Lista restrânsă a candidaților a fost întocmită în baza unei analize extinse,
                                în care au fost luați calcul următorii factori: rezultatele din alegerile locale 2015 și parlamentare 2014,
                                cele mai recente sondaje, precum și opiniile experților locali.
                                Orice sugestie în privința listei restrânse a candidaților poate fi expediată la adresa:
                                <a href='mail&#116;o&#58;&#100;efa&#99;&#37;74o%2E&#109;old%&#54;F&#37;76a&#64;g&#109;ail&#46;co&#109;'>de&#102;acto&#46;&#109;&#111;&#108;d&#111;va&#64;gmail&#46;&#99;om</a>
                            </p>
                        </div>
                    </div>
                </div>
                {% if election.problems|default %}
                    <div class="row pb-5">
                        <div class="col">
                            <h2 class="text-center mb-3">Top {{ election.problems|length }} probleme din circumscripție</h2>
                            <div class="row mb-4 justify-content-around">
                                {% for problem in election.problems %}
                                    <div class="col-4">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h5 class="card-title">{{ problem.problem.name }}</h5>
                                                <p class="card-text">
                                                    <small class="text-muted">
                                                        {{ problem.respondents }} respondenți
                                                    </small>
                                                </p>
                                                {% if election.problemOpinions[ problem.problem.id ] is defined %}
                                                    <hr>
                                                    <h6 class="text-secondary">Opinii</h6>
                                                    {% for opinion in election.problemOpinions[ problem.problem.id ] %}
                                                        <p class="{{ loop.last ? "mb-0" : "mb-1" }}">
                                                            <strong>
                                                                {{ opinion.politician.firstName }}
                                                                {{ opinion.politician.lastName }}
                                                            </strong>:
                                                            {{ opinion.opinion }}
                                                        </p>
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="alert alert-light" role="alert">
                                <h6 class="alert-heading">{{ "title.problems_metodology"|trans }}</h6>
                                <p class="mb-0 small">
                                    Principalele probleme la nivel local și național au fost identificate în cadrul sondajului 5000 de moldoveni au spus, în cadrul căruia au fost chestionați peste 5 mii de cetățeni din circumscripțiile uninominale, cu excepția regiunii transnistriene și a circumscripțiilor din afara țării.
                                    Sondajul a fost organizat în cadrul proiectului Avem ce votăm, implementat de coaliția următoarelor organizații din Moldova: deFacto, Inițiativa Civică „Pune Umărul”, Școala de Gândire Critică pentru Tineri „Challenger”, Programul „Femei cu Idei”.
                                </p>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="pb-5"></div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    {% include 'app/component/section/footer.html.twig' only %}
{% endblock %}
