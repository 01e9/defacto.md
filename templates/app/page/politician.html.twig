{% extends 'app/base.html.twig' %}
{% import 'macros.html.twig' as macros %}
{% import _self as self_macros %}

{% block html_class %}bg-dark-pattern{% endblock %}
{% block body_class %}bg-transparent{% endblock %}

{% block title %}Politician{% endblock %}

{% set logoSize = '2rem' %}
{% set maxImgWidth = '20rem' %}
{% set emptyHtml = '<p>&nbsp;</p>' %}
{% set detailClasses = {
    row: "row mb-3",
    colLabel: "col-lg-3",
    colContent: "col-lg-9",
} %}

{% block main %}
    <div class="container-fluid px-0 bg-white">
        {% include 'app/component/after-header-space.html.twig' %}
        <div class="container pb-5">
            <div class="row mb-3">
                <div class="col">
                    <h1>{{ politician.firstName }} {{ politician.lastName }}</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 mb-3 mb-lg-0">
                    <div>
                        <img
                            src="{{ macros.politician_photo_url(politician) }}"
                            alt="Map"
                            class="img-fluid w-100 rounded"
                            style="max-width: {{ maxImgWidth }};"
                        >
                    </div>
                </div>
                <div class="col-lg-9">
                    {% if politician.birthDate %}
                        {{ self_macros.detail_block(
                            "label.age"|trans,
                            politician.birthDate|age ~ " " ~ "text.years_n"|transchoice(politician.birthDate|age)
                        ) }}
                    {% endif %}
                    {% if politician.profession %}
                        {{ self_macros.detail_block("label.profession"|trans, politician.profession) }}
                    {% endif %}
                    {% if politician.studies and politician.studies != emptyHtml %}
                        {{ self_macros.detail_block("label.studies"|trans, politician.studies, "raw") }}
                    {% endif %}
                    {% if politician.previousTitles and politician.previousTitles != emptyHtml %}
                        {{ self_macros.detail_block("label.previous_titles"|trans, politician.previousTitles, "raw") }}
                    {% endif %}
                    {% if politician.website %}
                        {{ self_macros.detail_block("label.website"|trans, politician.website, "link") }}
                    {% endif %}
                    {% if politician.facebook %}
                        {{ self_macros.detail_block("label.facebook"|trans, politician.facebook, "link") }}
                    {% endif %}
                    {% if politician.email %}
                        {{ self_macros.detail_block("label.email"|trans, politician.email, "email") }}
                    {% endif %}
                    {% if politician.phone %}
                        {{ self_macros.detail_block("label.phone"|trans, politician.phone, "phone") }}
                    {% endif %}
                </div>
            </div>
            {% for candidate in politician.candidates %}
            <div class="row mt-5">
                <div class="col">
                    <h4 class="mb-3">
                        {{ "title.candidate_in"|trans }}
                        {{ candidate.election.name|lower }}
                        {{ "text.from"|trans }}
                        {{ candidate.election.date|date }}
                    </h4>
                    {% if candidate.constituency %}
                        <div class="mb-3">
                            <a
                                href="{{ path('constituency', {slug: candidate.constituency.slug, electionSlug: candidate.election.slug}) }}"
                            >{{ candidate.constituency.name }}</a>
                        </div>
                    {% endif %}
                    {% if candidate.party %}
                        <div class="mb-3">
                            <div class="row align-items-center">
                                <div class="col-auto pr-0">
                                    <div style="width: {{ logoSize }};" class="text-center">
                                        <img
                                            src="{{ macros.party_logo_url(candidate.party) }}"
                                            alt="Logo"
                                            style="max-width: {{ logoSize }}; max-height: {{ logoSize }};"
                                            class="rounded"
                                        >
                                    </div>
                                </div>
                                <div class="col">
                                    {{ candidate.party.name }}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% if candidate.registrationDate %}
                        <div class="{{ detailClasses.row }}">
                            <div class="{{ detailClasses.colLabel }}">
                                <strong>{{ "label.registration_date"|trans }}</strong>
                            </div>
                            <div class="{{ detailClasses.colContent }}">
                                {% if candidate.registrationLink %}
                                    <a
                                        href="{{ candidate.registrationLink }}"
                                        target="_blank"
                                    ><samp>{{ candidate.registrationDate|date }}</samp></a>
                                {% else %}
                                    <samp>{{ candidate.registrationDate|date }}</samp>
                                {% endif %}
                                {% if candidate.registrationNote %}
                                    <span class="ml-2">{{ candidate.registrationNote }}</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                    {% if candidate.electoralPlatform and candidate.electoralPlatform != emptyHtml %}
                        {{ self_macros.detail_block("label.electoral_platform"|trans, candidate.electoralPlatform, "raw") }}
                    {% endif %}
                    {% if candidate.electoralPlatformLink %}
                        <div class="{{ detailClasses.row }}">
                            <div class="{{ detailClasses.colLabel }}"></div>
                            <div class="{{ detailClasses.colContent }}">
                                <a href="{{ candidate.electoralPlatformLink }}" target="_blank">
                                    {{ "label.electoral_platform_link"|trans }}
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% include 'app/component/section/footer.html.twig' only %}
{% endblock %}

{% macro detail_block(label, content, mode) %}
    <div class="row mb-3">
        <div class="col-lg-3">
            <strong>{{ label }}</strong>
        </div>
        <div class="col-lg-9{% if mode == "raw" %} raw-html{% endif %}">
            {% if not mode %}
                {{ content }}
            {% elseif mode == "raw" %}
                {{ content|raw }}
            {% elseif mode == "link" %}
                <a href="{{ content }}" target="_blank">{{ content }}</a>
            {% elseif mode == "email" %}
                <a href="mailto:{{ content }}"><samp>{{ content }}</samp></a>
            {% elseif mode == "phone" %}
                <a href="tel:{{ content }}"><samp>{{ content }}</samp></a>
            {% else %}
                {{ content }}
            {% endif %}
        </div>
    </div>
{% endmacro %}
