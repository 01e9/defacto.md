{# @var \App\Entity\Politician politician #}
{# @var \App\Entity\Mandate mandate Optional #}
{# @var int rank Optional #}
{# @var bool is_mandate_page Optional #}

{% import 'macros.html.twig' as macros %}

{% set is_mandate_page = is_mandate_page is defined ? is_mandate_page : false %}
{% set maxPhotoWidth = '10rem' %}

<div class="container-fluid px-0 py-5 bg-dark-pattern text-white">
    <div class="container">
        <div class="row text-lg-center mb-4">
            <div class="col">
                <h1 class="mb-4">
                    {% if is_mandate_page %}
                        <a
                            href="{{ path('politician', {'slug': politician.slug}) }}"
                            class="text-white"
                        >
                            {{- "" -}}
                            <span itemprop="givenName">{{ politician.firstName }}</span>
                            <span itemprop="familyName">{{ politician.lastName }}</span>
                            {{- "" -}}
                        </a>
                    {% else %}
                        <span itemprop="givenName">{{ politician.firstName }}</span>
                        <span itemprop="familyName">{{ politician.lastName }}</span>
                    {% endif %}
                </h1>
                {% if mandate %}
                    <div class="d-inline-block bg-dark rounded p-3">
                        <div class="row">
                            <div class="text-left col-6 col-md-auto">
                                <span class="badge badge-warning">{{ mandate.beginDate|date }}</span>
                            </div>
                            <div class="text-center col-12 order-first col-md order-md-0 mb-3 mb-lg-0">
                                <span class="text-light h5 mb-0 mx-3">{{ mandate.institutionTitle.title.name }}</span>
                            </div>
                            <div class="text-right col-6 col-md-auto">
                                <span class="badge badge-warning">{{ mandate.endDate|date }}</span>
                            </div>
                        </div>
                        {% if mandate.endDate > date() %}
                            <div class="progress thin bg-info mandate-period mt-3">
                                <div class="progress-bar bg-warning rounded"
                                     style="width: {{ '' ~ macros.get_date_interval_progress(mandate.beginDate, mandate.endDate) }}%;"
                                >
                                    <span class="fas fa-circle text-warning rounded-circle"></span>
                                </div>
                            </div>
                            <div class="mt-3 small text-info text-right">
                                <small>{{ "text.the_mandate_ends_in"|trans({"%time%": mandate.endDate|ago}) }}</small>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="row align-items-lg-center">
            <div class="col-12 col-lg text-lg-right">
                {% if rank %}
                    <a
                        class="text-info d-inline-block no-underline"
                        href="{{ path('mandates', {"electionSlug": mandate.election.slug}) }}"
                    >
                        <sup class="font-size-2 mr-3">{{ "label.the_place"|trans|lower }}</sup>
                        <span class="font-size-6">{{ rank }}</span>
                    </a>
                {% endif %}
            </div>
            <div class="col-12 col-lg-auto px-lg-5">
                <a
                    href="{{ path('politician', {'slug': politician.slug}) }}"
                    class="d-inline-block"
                >
                    <img
                        src="{{ macros.politician_photo_url(politician) }}"
                        alt="{{ politician.firstName ~ " " ~ politician.lastName }}"
                        class="d-inline-block bg-white rounded-circle"
                        style="max-width: {{ maxPhotoWidth }};"
                        itemprop="image"
                    >
                </a>
            </div>
            <div class="col-12 col-lg">
                {% if mandate %}
                    {% set content %}
                        <span class="font-size-6">{{ mandate.competenceUsesPoints }}</span>
                        <sup class="font-size-2 ml-3">{{ "text.points"|trans({"%count%": mandate.competenceUsesPoints}) }}</sup>
                    {% endset %}
                    {% if is_mandate_page %}
                        <div class="text-warning">{{ content }}</div>
                    {% else %}
                        <a
                            class="text-warning d-inline-block no-underline"
                            href="{{ path('mandate', {'electionSlug': mandate.election.slug, 'politicianSlug': politician.slug}) }}"
                        >{{ content }}</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        {% if mandate %}
            <div class="row mt-5">
                <div class="col text-lg-center">
                    <a
                        class="btn btn-outline-info"
                        href="{{ path('mandates', {"electionSlug": mandate.election.slug}) }}"
                    >{{ "action.see_the_politicians_points"|trans }}</a>
                    {% if not is_mandate_page %}
                        <span class="d-block d-lg-inline px-2 mb-5 mb-lg-0"></span>
                        <a
                            class="btn btn-outline-warning"
                            href="{{ path('mandate', {'electionSlug': mandate.election.slug, 'politicianSlug': politician.slug}) }}"
                        >{{ "action.see_points_details"|trans }}</a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</div>

